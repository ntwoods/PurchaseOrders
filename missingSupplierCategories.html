<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Manager</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-zinc-900 text-gray-100;
        }
        .scroll-container::-webkit-scrollbar {
            width: 8px;
        }
        .scroll-container::-webkit-scrollbar-track {
            background: #27272a; /* zinc-800 */
        }
        .scroll-container::-webkit-scrollbar-thumb {
            background-color: #52525b; /* zinc-600 */
            border-radius: 4px;
        }
        .scroll-container::-webkit-scrollbar-thumb:hover {
            background-color: #71717a; /* zinc-500 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Main Container -->
    <div class="w-full max-w-2xl bg-zinc-800 rounded-2xl shadow-xl p-6 md:p-8 space-y-6 transform transition-all duration-300">
        
        <div class="flex flex-col items-center justify-center space-y-2">
            <h1 class="text-3xl font-bold text-center text-green-400">Category Manager</h1>
            <p class="text-center text-sm text-gray-400">Manage categories by approving or rejecting them.</p>
        </div>

        <!-- Status Message -->
        <div id="status-message" class="text-center text-sm font-medium transition-all duration-300 h-6"></div>

        <!-- Table Container -->
        <div class="w-full h-80 overflow-y-auto scroll-container border border-zinc-700 rounded-xl">
            <table class="min-w-full divide-y divide-zinc-700">
                <thead class="sticky top-0 bg-zinc-700/80 backdrop-blur-sm z-10">
                    <tr>
                        <th scope="col" class="py-3.5 px-4 text-left text-sm font-semibold text-gray-100 rounded-tl-xl">Category Name</th>
                        <th scope="col" class="py-3.5 px-4 text-right text-sm font-semibold text-gray-100 rounded-tr-xl">Actions</th>
                    </tr>
                </thead>
                <tbody id="category-table-body" class="divide-y divide-zinc-700">
                    <!-- Categories will be injected here by JavaScript -->
                    <tr>
                        <td colspan="2" class="p-4 text-center text-sm text-gray-400">Loading categories...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal for Remarks -->
    <div id="remark-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300 opacity-0">
        <div class="bg-zinc-800 rounded-2xl p-6 w-96 max-w-[90%] shadow-2xl space-y-4">
            <h2 class="text-xl font-bold text-gray-100">Provide a Remark</h2>
            <p class="text-sm text-gray-400">Please explain why you are rejecting this category.</p>
            <textarea id="remark-input" class="w-full p-3 bg-zinc-700 border border-zinc-600 rounded-lg text-sm text-gray-100 resize-none outline-none focus:ring-2 focus:ring-green-500" rows="4" placeholder="Enter your reason here..."></textarea>
            <div class="flex justify-end gap-3">
                <button id="modal-cancel-btn" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-400 hover:text-gray-100 hover:bg-zinc-700 transition-colors duration-200">Cancel</button>
                <button id="modal-submit-btn" class="px-5 py-2 text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700 transition-colors duration-200 shadow-md">Submit</button>
            </div>
        </div>
    </div>

    <!-- JavaScript for fetching data and handling logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_URL = 'https://script.google.com/macros/s/AKfycbwYeYhtJHjGOkQIXhJ4T3-t-pOup7c4-OC6-f_we8gf1lc8OBVONrikcasmqjts5aVU/exec';
            const tableBody = document.getElementById('category-table-body');
            const statusMessage = document.getElementById('status-message');
            const remarkModal = document.getElementById('remark-modal');
            const remarkInput = document.getElementById('remark-input');
            const modalSubmitBtn = document.getElementById('modal-submit-btn');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');

            let selectedCategory = null;

            /**
             * Updates the status message on the page.
             * @param {string} message - The message to display.
             * @param {string} type - 'success', 'error', or 'info'.
             */
            function updateStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'text-center text-sm font-medium transition-all duration-300 h-6';
                if (type === 'success') {
                    statusMessage.classList.add('text-green-500');
                } else if (type === 'error') {
                    statusMessage.classList.add('text-red-500');
                } else {
                    statusMessage.classList.add('text-gray-400');
                }
            }

            /**
             * Shows the remark modal.
             */
            function showModal() {
                remarkModal.classList.remove('hidden');
                setTimeout(() => {
                    remarkModal.classList.add('opacity-100');
                }, 10);
            }

            /**
             * Hides the remark modal and resets input.
             */
            function hideModal() {
                remarkModal.classList.remove('opacity-100');
                setTimeout(() => {
                    remarkModal.classList.add('hidden');
                }, 300);
                remarkInput.value = '';
                selectedCategory = null;
            }

            /**
             * Renders the categories in the table.
             * @param {string[]} categories - The combined array of category names.
             */
            function renderCategories(categories) {
                tableBody.innerHTML = ''; // Clear previous content
                if (categories.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="2" class="p-4 text-center text-sm text-gray-400">No categories found.</td></tr>`;
                    return;
                }
                
                categories.forEach(category => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-zinc-700 transition-colors duration-200';
                    row.innerHTML = `
                        <td class="py-3 px-4 text-sm font-normal text-gray-300">${category}</td>
                        <td class="py-3 px-4 text-right">
                            <div class="inline-flex space-x-2">
                                <!-- Approve Button (Tick) -->
                                <button class="approve-btn p-2 rounded-full bg-green-600 hover:bg-green-700 transition-all duration-200" data-category="${category}" title="Approve">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                                <!-- Reject Button (Cross) -->
                                <button class="reject-btn p-2 rounded-full bg-red-600 hover:bg-red-700 transition-all duration-200" data-category="${category}" title="Reject">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            /**
             * Sends a POST request to the API with the given payload.
             * @param {object} payload - The data to send.
             */
            async function postData(payload) {
                try {
                    updateStatus('Sending data...', 'info');
                    // Note: Google Apps Script can often handle both GET and POST to the same URL.
                    // Assuming this is the case, we'll post to the same URL.
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        mode: 'no-cors', // Use 'no-cors' mode to avoid CORS issues with simple POST
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload)
                    });

                    // Due to 'no-cors', we cannot check response.ok or read response body.
                    // We'll optimistically assume success.
                    updateStatus(`Success: Data sent for "${payload.category}"`, 'success');

                } catch (error) {
                    console.error('Error sending data:', error);
                    updateStatus('Failed to send data. Check console for details.', 'error');
                }
            }

            // Fetch categories on page load
            async function fetchAndRenderCategories() {
                try {
                    updateStatus('Loading categories...', 'info');
                    const response = await fetch(API_URL);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    
                    // Combine the two arrays into a single list
                    const allCategories = [...data.fromColumnB, ...data.fromColumnG];
                    renderCategories(allCategories);
                    updateStatus(`Loaded ${allCategories.length} categories.`, 'success');
                } catch (error) {
                    console.error('Failed to fetch categories:', error);
                    tableBody.innerHTML = `<tr><td colspan="2" class="p-4 text-center text-sm text-red-400">Error loading categories. Please try again later.</td></tr>`;
                    updateStatus('Failed to fetch categories.', 'error');
                }
            }

            // Event listeners for the table body (using event delegation for efficiency)
            tableBody.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;

                const category = button.dataset.category;
                
                if (button.classList.contains('approve-btn')) {
                    // Handle right sign click
                    postData({ category: category });
                } else if (button.classList.contains('reject-btn')) {
                    // Handle cross sign click
                    selectedCategory = category;
                    showModal();
                }
            });

            // Event listeners for the modal buttons
            modalSubmitBtn.addEventListener('click', () => {
                const remark = remarkInput.value.trim();
                if (selectedCategory && remark) {
                    postData({ category: selectedCategory, remark: remark });
                    hideModal();
                } else {
                    updateStatus('Remark cannot be empty.', 'error');
                }
            });

            modalCancelBtn.addEventListener('click', hideModal);

            // Fetch data initially
            fetchAndRenderCategories();
        });
    </script>

</body>
</html>
